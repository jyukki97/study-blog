{{- if .Site.Params.comments -}}
{{- if and (.Site.Params.giscus.repo) (not .Params.disableComments) -}}
<div id="comments" class="comments-container">
    <div class="comments-header">
        <h3 class="comments-title">
            <i class="comments-icon" aria-hidden="true">ğŸ’¬</i>
            ëŒ“ê¸€
        </h3>
        <div class="comments-info">
            <small>GitHub ê³„ì •ìœ¼ë¡œ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
        </div>
    </div>
    
    <div class="giscus-container">
        <script src="https://giscus.app/client.js"
                data-repo="{{ .Site.Params.giscus.repo }}"
                data-repo-id="{{ .Site.Params.giscus.repoID }}"
                data-category="{{ .Site.Params.giscus.category | default "General" }}"
                data-category-id="{{ .Site.Params.giscus.categoryID }}"
                data-mapping="{{ .Site.Params.giscus.mapping | default "pathname" }}"
                data-strict="{{ .Site.Params.giscus.strict | default "0" }}"
                data-reactions-enabled="{{ .Site.Params.giscus.reactionsEnabled | default "1" }}"
                data-emit-metadata="{{ .Site.Params.giscus.emitMetadata | default "0" }}"
                data-input-position="{{ .Site.Params.giscus.inputPosition | default "bottom" }}"
                data-theme="{{ .Site.Params.giscus.theme | default "preferred_color_scheme" }}"
                data-lang="{{ .Site.Params.giscus.lang | default "ko" }}"
                data-loading="lazy"
                crossorigin="anonymous"
                async>
        </script>
    </div>
    
    <!-- ëŒ“ê¸€ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
    <div id="comments-preview" class="comments-preview" style="display: none;">
        <div class="preview-header">
            <span class="preview-title">ë¯¸ë¦¬ë³´ê¸°</span>
            <button id="close-preview" class="close-preview-btn" aria-label="ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°">Ã—</button>
        </div>
        <div class="preview-content"></div>
    </div>
    
    <!-- ëŒ“ê¸€ ì•Œë¦¼ -->
    <div id="comment-notification" class="comment-notification" style="display: none;">
        <div class="notification-content">
            <span class="notification-icon">ğŸ””</span>
            <span class="notification-text"></span>
            <button class="notification-close" aria-label="ì•Œë¦¼ ë‹«ê¸°">Ã—</button>
        </div>
    </div>
</div>

<!-- ëŒ“ê¸€ ê´€ë ¨ JavaScript -->
<script>
// Giscus í…Œë§ˆ ë™ê¸°í™”
function syncGiscusTheme() {
    const theme = document.documentElement.getAttribute('data-theme') || 'auto';
    const giscusFrame = document.querySelector('iframe.giscus-frame');
    if (giscusFrame) {
        giscusFrame.contentWindow.postMessage({
            giscus: {
                setConfig: {
                    theme: theme === 'dark' ? 'dark' : theme === 'light' ? 'light' : 'preferred_color_scheme'
                }
            }
        }, 'https://giscus.app');
    }
}

// í…Œë§ˆ ë³€ê²½ ê°ì§€ ë° Giscus ë™ê¸°í™”
const themeObserver = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
            setTimeout(syncGiscusTheme, 100);
        }
    });
});

themeObserver.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
});

// Giscus ë¡œë“œ ì™„ë£Œ í›„ í…Œë§ˆ ë™ê¸°í™”
window.addEventListener('message', (event) => {
    if (event.origin !== 'https://giscus.app') return;
    
    if (event.data.giscus?.discussion) {
        syncGiscusTheme();
        
        // ëŒ“ê¸€ ë¡œë“œ ì•Œë¦¼
        showCommentNotification('ëŒ“ê¸€ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
});

// ëŒ“ê¸€ ì•Œë¦¼ í‘œì‹œ
function showCommentNotification(message) {
    const notification = document.getElementById('comment-notification');
    const notificationText = notification.querySelector('.notification-text');
    
    notificationText.textContent = message;
    notification.style.display = 'block';
    
    // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// ì•Œë¦¼ ë‹«ê¸° ë²„íŠ¼
document.addEventListener('click', (e) => {
    if (e.target.matches('.notification-close')) {
        e.target.closest('.comment-notification').style.display = 'none';
    }
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ“ê¸€ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤ (URL í•´ì‹œê°€ #commentsì¸ ê²½ìš°)
if (window.location.hash === '#comments') {
    setTimeout(() => {
        document.getElementById('comments')?.scrollIntoView({ behavior: 'smooth' });
    }, 1000);
}
</script>
{{- end -}}
{{- end -}}
