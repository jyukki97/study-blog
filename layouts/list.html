{{ define "main" }}
<main class="main">
    {{ if .Site.Params.cover.enabled }}
        {{ partial "cover.html" . }}
    {{ end }}
    {{ if .Site.Params.ProfileMode }}
        {{ partial "profile.html" . }}
    {{ end }}

    <section class="list-page">
        {{ if and .IsHome .Site.Params.showTagsOnHome }}
            <div class="tags-section">
                <div class="tags-header">
                    <h2>Tags</h2>
                    <a href="{{ "tags" | relURL }}" class="more-link">More →</a>
                </div>
                <div class="all-tags">
                    {{ range .Site.Taxonomies.tags }}
                        <a href="{{ .Page.RelPermalink }}" class="tag-link">
                            {{ .Page.Title }}
                        </a>
                    {{ end }}
                </div>
            </div>
        {{ end }}

        <div class="post-header">
            <h2>Posts</h2>
            {{ if and .IsHome }}
            <a href="{{ "posts" | relURL }}" class="more-link">More →</a>
            {{ end }}
        </div>

        <div class="post-grid">
            {{ $pages := .Pages }}
            {{ if .IsHome }}
                {{ $pages = .Site.RegularPages }}
            {{ end }}
            {{ $paginator := .Paginate $pages }}
            {{ range $paginator.Pages }}
                <article class="post-entry">
                    {{ if .Params.cover.image }}
                        <a class="post-cover" href="{{ .Permalink }}">
                            <img src="{{ .Params.cover.image | relURL }}" alt="{{ .Title }}">
                        </a>
                    {{ else }}
                        <a class="post-cover no-image" href="{{ .Permalink }}">
                            <div class="title-overlay">
                                <h2>{{ .Title }}</h2>
                            </div>
                        </a>
                    {{ end }}
                    <div class="post-content">
                        {{ if .Params.tags }}
                            <div class="post-tags-container">
                                <div class="post-tags" id="post-tags-{{ .RelPermalink | urlize }}">
                                    {{ range $index, $tag := .Params.tags }}
                                        <a href="{{ "tags/" | relURL }}{{ . | urlize }}" class="post-tag">{{ . }}</a>
                                    {{ end }}
                                </div>
                                {{ if gt (len .Params.tags) 3 }}
                                <button class="show-more-tags" onclick="toggleTags('{{ .RelPermalink | urlize }}')">
                                    <span class="show-text">더보기 (+{{ sub (len .Params.tags) 3 }})</span>
                                    <span class="hide-text" style="display: none;">접기</span>
                                </button>
                                {{ end }}
                            </div>
                        {{ end }}
                        <h2 class="post-title">
                            <a href="{{ .Permalink }}">{{ .Title }}</a>
                        </h2>
                        <div class="post-meta">
                            <span title='{{ .Date }}'>{{ .Date | time.Format (default "January 2, 2006" site.Params.DateFormat) }}</span>
                        </div>
                        {{ if .Description }}
                            <p class="post-summary">{{ .Description }}</p>
                        {{ end }}
                    </div>
                </article>
            {{ end }}
        </div>

        {{- /* 포스트 리스트 후 광고 */ -}}
        {{- partial "ads.html" (dict "position" "banner") }}

        {{ if gt $paginator.TotalPages 1 }}
            <nav class="pagination">
                {{ if $paginator.HasPrev }}
                    <a class="prev" href="{{ $paginator.Prev.URL | relURL }}">← {{ i18n "prev_page" }}</a>
                {{ end }}
                {{ if $paginator.HasNext }}
                    <a class="next" href="{{ $paginator.Next.URL | relURL }}">{{ i18n "next_page" }} →</a>
                {{ end }}
            </nav>
        {{ end }}
    </section>
</main>

<style>
.post-header {
    margin: 2rem 0;
    padding: 0 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.post-header h2 {
    margin: 0;
    font-size: 1.8rem;
    color: var(--primary-color, #b19cd9);
    background: linear-gradient(135deg, var(--primary-color, #b19cd9), var(--primary-dark, #8a67b8));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

.post-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.post-entry {
    background: var(--bg-primary, #ffffff);
    border: 1px solid var(--border-color, #e2e8f0);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px var(--shadow-light, rgba(0, 0, 0, 0.1));
}

.post-entry:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 24px var(--shadow-medium, rgba(0, 0, 0, 0.15));
    border-color: var(--primary-color, #b19cd9);
}

.post-cover {
    display: block;
    width: 100%;
    height: 200px;
    overflow: hidden;
    position: relative;
}

.post-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
}

.post-entry:hover .post-cover img {
    transform: scale(1.05);
}

.no-image {
    background: linear-gradient(45deg, #b19cd9, #8a6cb3);
}

.title-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    text-align: center;
}

.title-overlay h2 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
}

.post-content {
    padding: 1.5rem;
}

.post-tags-container {
    margin-bottom: 0.5rem;
    overflow: visible; /* 오버플로우 방지 */
}

.post-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    overflow: hidden;
    transition: max-height 0.3s ease;
    padding: 0.5rem 0;
    line-height: 1.8;
}

.post-tags.expanded {
    max-height: none;
}

.all-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.show-more-tags {
    background: none;
    border: none;
    color: var(--primary-color, #b19cd9);
    cursor: pointer;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    transition: all 0.3s ease;
    border-radius: 20px;
    margin: 0.1rem 0 0 0;
    border: 1px solid transparent;
    min-height: 2rem; /* 최소 높이 감소 */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    min-height: 2rem;
    box-sizing: border-box;
}

.show-more-tags:hover {
    color: white;
    background: var(--primary-color, #b19cd9);
    border: 1px solid var(--primary-color, #b19cd9);
    border-radius: 16px !important;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(177, 156, 217, 0.3);
}

.post-title {
    margin: 0 0 1rem;
    font-size: 1.5rem;
}

.post-title a {
    color: var(--primary);
    text-decoration: none;
}

.post-summary {
    color: var(--secondary);
    margin-bottom: 1rem;
    line-height: 1.6;
}

.post-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--secondary);
    font-size: 0.9rem;
}

.tags-section {
    margin: 2rem 0;
    padding: 0 1rem;
}

.tags-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.tags-header h2 {
    margin: 0;
    font-size: 1.8rem;
    color: var(--primary-color, #b19cd9);
    background: linear-gradient(135deg, var(--primary-color, #b19cd9), var(--primary-dark, #8a67b8));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

.post-tag,
.tag-link,
.more-link {
    color: var(--primary-color, #b19cd9);
    text-decoration: none;
    padding: 0.5rem 1rem; /* 패딩 조정 */
    border-radius: 20px !important;
    background: var(--bg-secondary, #f8f9fa);
    transition: all 0.3s ease;
    font-size: 0.9rem;
    border: 1px solid var(--primary-color, #b19cd9);
    position: relative;
    overflow: visible;
    white-space: nowrap;
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0.1rem 0; /* 마진 감소 */
    min-height: 2rem; /* 최소 높이 감소 */
    box-sizing: border-box;
}

.post-tag::before,
.tag-link::before,
.more-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color, #b19cd9), var(--primary-hover, #9a7bc8));
    transition: left 0.3s ease;
    z-index: -1;
    border-radius: 20px; /* ::before 요소도 둥글게 */
}

.post-tag:hover,
.tag-link:hover,
.more-link:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(177, 156, 217, 0.3);
    border-radius: 20px !important; /* hover 시에도 둥근 모서리 유지 */
}

.post-tag:hover::before,
.tag-link:hover::before,
.more-link:hover::before {
    left: 0;
}

/* 더보기 링크 특별 스타일 */
.more-link {
    font-size: 0.9rem;
    padding: 0.3rem 0.8rem;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
}

.pagination a {
    color: var(--primary-color, #b19cd9);
    text-decoration: none;
    border-radius: 24px !important; /* 페이지네이션은 더 둥글게 */
    background: var(--bg-secondary, #f8f9fa);
    transition: all 0.3s ease;
    border: 2px solid var(--primary-color, #b19cd9);
    font-weight: 500;
    position: relative;
    overflow: hidden;
}

.pagination a::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color, #b19cd9), var(--primary-hover, #9a7bc8));
    transition: left 0.3s ease;
    z-index: -1;
    border-radius: 24px;
}

.pagination a:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(177, 156, 217, 0.4);
    border-radius: 24px !important;
}

.pagination a:hover::before {
    left: 0;
}

/* 다크 모드 지원 */
[data-theme="dark"] .post-entry {
    background: var(--bg-secondary, #2d3748);
    border-color: var(--border-color, #4a5568);
}

[data-theme="dark"] .post-tag,
[data-theme="dark"] .tag-link,
[data-theme="dark"] .more-link,
[data-theme="dark"] .pagination a {
    background: var(--bg-tertiary, #4a5568);
    border-color: var(--primary-color, #b19cd9);
    color: var(--primary-color, #b19cd9);
}

[data-theme="dark"] .post-tag:hover,
[data-theme="dark"] .tag-link:hover,
[data-theme="dark"] .more-link:hover,
[data-theme="dark"] .pagination a:hover {
    color: white;
    border-radius: 20px !important; /* 다크모드에서도 둥근 모서리 유지 */
}

[data-theme="dark"] .pagination a:hover {
    border-radius: 24px !important; /* 페이지네이션은 더 둥글게 */
}

[data-theme="dark"] .show-more-tags {
    color: var(--primary-color, #b19cd9);
}

[data-theme="dark"] .show-more-tags:hover {
    color: white;
    background: var(--primary-color, #b19cd9);
    border: 1px solid var(--primary-color, #b19cd9);
    border-radius: 16px !important;
}

/* 모바일 반응형 */
@media (max-width: 768px) {
    .post-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .post-header,
    .tags-section {
        padding: 0 0.5rem;
    }
    
    .post-header,
    .tags-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .post-header h2,
    .tags-header h2 {
        font-size: 1.5rem;
    }
    
    .post-tags,
    .all-tags {
        gap: 0.4rem; /* 모바일에서 더 작은 간격 */
    }
    
    .post-tag,
    .tag-link,
    .more-link {
        font-size: 0.8rem;
        padding: 0.5rem 0.8rem; /* 패딩 증가 */
        border-radius: 16px !important; /* 모바일에서는 덜 둥글게 */
        margin: 0.2rem 0; /* 상하 마진 추가 */
        min-height: 2rem; /* 최소 높이 설정 */
    }
    
    .pagination a {
        border-radius: 20px !important; /* 모바일에서 페이지네이션도 덜 둥글게 */
    }
    
    .show-more-tags {
        font-size: 0.9rem;
        margin: 0.1rem 0 0 0;
        padding: 0.4rem 0.6rem;
        border-radius: 20px !important;
        min-height: 2rem;
        box-sizing: border-box;
    }
    
    .post-tags {
        max-height: 4.2em; /* 모바일에서도 충분한 높이 */
        padding: 0.5rem 0;
    }
    
    .pagination {
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
    }
    
    .pagination a {
        width: 100%;
        max-width: 200px;
        text-align: center;
    }
}
</style>

<script>
function toggleTags(postId) {
    const tagsContainer = document.getElementById('post-tags-' + postId);
    const button = event.target.closest('.show-more-tags');
    const showText = button.querySelector('.show-text');
    const hideText = button.querySelector('.hide-text');
    
    if (tagsContainer.classList.contains('expanded')) {
        tagsContainer.classList.remove('expanded');
        showText.style.display = 'inline';
        hideText.style.display = 'none';
    } else {
        tagsContainer.classList.add('expanded');
        showText.style.display = 'none';
        hideText.style.display = 'inline';
    }
}
</script>
{{ end }}
